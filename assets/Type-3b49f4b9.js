import{r as t,ar as _,bv as R,bw as L,as as ne,at as le,z as e,au as ie,av as de,a0 as Q,a1 as H,a5 as ce,aB as U,bx as $,by as me,ab as ue,ao as pe,bz as xe,ap as v,K as be,ax as he,ay as N,aJ as E,aK as h,aL as F,aM as g,aN as f,bA as ge,bB as je,aQ as M,aR as B,aS as ye,aT as fe,bC as ve,bD as Se,T as Te,E as we,aW as Ce,aX as Ne,aC as ke,M as _e,N as k,O as Ae,P as Ie,Q as De}from"./index-9864f4cb.js";const q=t.createContext(_),Ee=({children:o})=>{const[n,m]=t.useState(_.selected),[u,l]=t.useState(_.itemIdForUpdate),{isLoading:c}=R(),a=L(),r=t.useMemo(()=>ne(c,a),[c,a]),p=t.useMemo(()=>le(a,n),[a,n]);return e.jsx(q.Provider,{value:{selected:n,itemIdForUpdate:u,setItemIdForUpdate:l,disabled:r,isAllSelected:p,onSelect:x=>{ie(x,n,m)},onSelectAll:()=>{de(p,m,a)},clearSelected:()=>{m([])}},children:o})},b=()=>t.useContext(q),Fe=()=>{const o={borderRadius:"0.475rem",boxShadow:"0 0 50px 0 rgb(82 63 105 / 15%)",backgroundColor:"#fff",color:"#7e8299",fontWeight:"500",margin:"0",width:"auto",padding:"1rem 2rem",top:"calc(50% - 2rem)",left:"calc(50% - 4rem)"};return e.jsx("div",{style:{...o,position:"absolute",textAlign:"center"},children:"Processing..."})},Me=Q().shape({name:H().min(3,"Minimum 3 symbols").required("Name is required")}),P=({category:o,isCategoryLoading:n})=>{const{setItemIdForUpdate:m}=b(),{refetch:u}=R(),[l]=t.useState({...o}),c=r=>{r&&u(),m(void 0)},a=ce({initialValues:l,validationSchema:Me,onSubmit:async(r,{setSubmitting:p})=>{p(!0);try{U(r._id)?await $(r==null?void 0:r._id,r):(console.log("values",r),delete r.available,await me(r))}catch(x){console.error(x)}finally{p(!0),c(!0)}}});return e.jsxs(e.Fragment,{children:[e.jsxs("form",{id:"kt_modal_add_user_form",className:"form ",onSubmit:a.handleSubmit,noValidate:!0,children:[e.jsx("div",{className:"d-flex flex-column scroll-y me-n7 pe-7",id:"kt_modal_add_user_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_user_header","data-kt-scroll-wrappers":"#kt_modal_add_user_scroll","data-kt-scroll-offset":"300px",children:e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 ps-2 mb-2",children:"Name"}),e.jsx("input",{placeholder:"Full name",...a.getFieldProps("name"),type:"text",name:"name",className:ue("form-control form-control-solid mb-3 ms-2 mb-lg-0",{"is-invalid":a.touched.name&&a.errors.name},{"is-valid":a.touched.name&&!a.errors.name}),autoComplete:"off",disabled:a.isSubmitting||n}),a.touched.name&&a.errors.name&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("div",{className:"fv-help-block",children:e.jsx("span",{role:"alert",children:a.errors.name})})})]})}),e.jsxs("div",{className:"text-center pt-15",children:[e.jsx("button",{type:"reset",onClick:()=>c(),className:"btn btn-light me-3","data-kt-users-modal-action":"cancel",disabled:a.isSubmitting||n,children:"Discard"}),e.jsxs("button",{type:"submit",className:"btn btn-primary","data-kt-users-modal-action":"submit",disabled:n||a.isSubmitting||!a.isValid||!a.touched,children:[e.jsx("span",{className:"indicator-label",children:"Submit"}),(a.isSubmitting||n)&&e.jsxs("span",{className:"indicator-progress",children:["Please wait..."," ",e.jsx("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]}),(a.isSubmitting||n)&&e.jsx(Fe,{})]})},Be=()=>{const{itemIdForUpdate:o,setItemIdForUpdate:n}=b(),m=U(o),{isLoading:u,data:l,error:c}=pe(`${v.TYPES_LIST}-type-${o}`,()=>xe(o),{cacheTime:0,enabled:m,onError:a=>{n(void 0),console.error(a)}});return o?!u&&!c&&l?e.jsx(P,{isCategoryLoading:u,category:l}):null:e.jsx(P,{isCategoryLoading:u,category:{_id:void 0,available:!0}})},Pe=()=>{const{setItemIdForUpdate:o}=b();return e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"fw-bolder",children:"Add Type"}),e.jsx("div",{className:"btn btn-icon btn-sm btn-active-icon-primary","data-kt-users-modal-action":"close",onClick:()=>o(void 0),style:{cursor:"pointer"},children:e.jsx(be,{iconName:"cross",className:"fs-1"})})]})},Re=()=>(t.useEffect(()=>(document.body.classList.add("modal-open"),()=>{document.body.classList.remove("modal-open")}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal fade show d-block",id:"kt_modal_add_user",role:"dialog",tabIndex:-1,"aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered mw-650px",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(Pe,{}),e.jsx("div",{className:"modal-body scroll-y mx-5 mx-xl-15 my-7",children:e.jsx(Be,{})})]})})}),e.jsx("div",{className:"modal-backdrop fade show"})]})),Le=()=>{const{selected:o,clearSelected:n}=b(),m=he(),{setItemIdForUpdate:u}=b(),[l,c]=t.useState({}),{active:a,archived:r}=L(),[p,x]=t.useState(!1),[V,S]=t.useState(a),[O,T]=t.useState(()=>r),[i,K]=t.useState(null),[j,y]=t.useState(null),[W,w]=t.useState(!1),[z,G]=t.useState(),J=t.useMemo(()=>[{accessorKey:"name",header:"Name",muiEditTextFieldProps:{required:!0,error:!!(l!=null&&l.name),helperText:l==null?void 0:l.name,onFocus:()=>c({...l,name:void 0})}}],[]),X=Q().shape({name:H().min(3,"Minimum 3 symbols").required("Name is required")}),Y=async s=>{console.log(s.row.original),X.validate(s.row.original).catch(d=>c(d.message)),c({}),await C.mutateAsync({id:s.row.original._id,update:s.values}),D.setEditingRow(null)},Z=()=>{w(!0)},ee=async()=>{await se.mutateAsync(),w(!1)},ae=()=>{u(null)},A=()=>{w(!1)},se=N(()=>ge(z),{onSuccess:()=>{m.invalidateQueries([`${v.BRNACHES_LIST}`]),x(!0)}}),te=N(s=>je(s),{onSuccess:()=>{m.invalidateQueries([`${v.BRNACHES_LIST}`]),x(!0),n()}}),C=N(({id:s,update:d})=>$(s,d),{onSuccess:()=>{m.invalidateQueries([`${v.BRNACHES_LIST}`])}}),I={columns:J,enableRowDragging:!0,enableFullScreenToggle:!1,muiTableContainerProps:{sx:{minHeight:"320px"}},onDraggingRowChange:K,state:{draggingRow:i}};t.useEffect(()=>{console.log("branche",a),S(a),T(r)},[a,r,p]);const D=E({...I,enableRowSelection:!0,enableStickyHeader:!0,enableCellActions:!0,enableClickToCopy:"context-menu",enableEditing:!0,editDisplayMode:"row",createDisplayMode:"row",rowPinningDisplayMode:"select-sticky",positionToolbarAlertBanner:"bottom",positionActionsColumn:"last",state:{columnOrder:["mrt-row-select","mrt-row-drag","name"]},renderTopToolbarCustomActions:({table:s})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-success",children:"Active"})}),e.jsxs(h,{sx:{display:"flex",gap:"1rem",p:"4px",justifyContent:"right"},children:[e.jsx(f,{color:"info",onClick:ae,variant:"contained",children:"Add Type"}),e.jsx(f,{color:"error",onClick:async()=>{let d=[];s.getSelectedRowModel().rows.map(oe=>d.push(oe.original._id)),console.log(d),await te.mutateAsync(d)},variant:"contained",children:"Delete Selected"})]})]}),data:V,onEditingRowCancel:()=>c({}),onEditingRowSave:s=>Y(s),getRowId:s=>`table-1-${s.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{j==="table-2"&&(await C.mutateAsync({id:i==null?void 0:i.original._id,update:{deleted:!0}}),T(s=>[...s,i.original]),S(s=>s.filter(d=>d!==i.original))),y(null)}},muiTablePaperProps:{onDragEnter:()=>y("table-1"),sx:{outline:j==="table-1"?"2px dashed green":void 0}},renderRowActions:({row:s,table:d})=>e.jsxs(h,{sx:{display:"flex",gap:"1rem"},children:[e.jsx(M,{title:"Edit",children:e.jsx(B,{onClick:()=>d.setEditingRow(s),children:e.jsx(ye,{})})}),e.jsx(M,{title:"Delete",children:e.jsx(B,{color:"error",onClick:()=>{G(s.original._id),Z()},children:e.jsx(fe,{})})})]})}),re=E({...I,data:O,defaultColumn:{size:100},state:{columnOrder:["mrt-row-select","mrt-row-drag","name"]},getRowId:s=>`table-2-${s.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{j==="table-1"&&(console.log("getRowId",i==null?void 0:i.original._id),await C.mutateAsync({id:i==null?void 0:i.original._id,update:{deleted:!1}}),S(s=>[...s,i.original]),T(s=>s.filter(d=>d!==i.original))),y(null)}},muiTablePaperProps:{onDragEnter:()=>y("table-2"),sx:{outline:j==="table-2"?"2px dashed pink":void 0}},renderTopToolbarCustomActions:()=>e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-danger",children:"Archive"})})});return e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx(F,{table:D})}),e.jsx(h,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx(F,{table:re})}),e.jsxs(g,{show:W,onHide:A,children:[e.jsx(g.Header,{closeButton:!0,children:e.jsx(g.Title,{children:"Confirm Deletion"})}),e.jsx(g.Body,{children:"Are you sure you want to delete this item?"}),e.jsx(g.Footer,{children:e.jsxs(h,{sx:{display:"flex",gap:"1rem",p:"4px"},children:[e.jsx(f,{color:"info",variant:"contained",onClick:A,children:"Cancel"}),e.jsx(f,{color:"error",variant:"contained",onClick:ee,children:"Delete"})]})})]})]})},Qe=()=>{const{itemIdForUpdate:o}=b();return e.jsxs(e.Fragment,{children:[e.jsx(ke,{children:e.jsx(Le,{})}),o!==void 0&&e.jsx(Re,{})]})},He=()=>e.jsx(ve,{children:e.jsx(Se,{children:e.jsxs(Ee,{children:[e.jsx(Te,{}),e.jsx(we,{children:e.jsx(Ce,{backend:Ne,children:e.jsx(Qe,{})})})]})})}),Ue=[{title:"Types Management",path:"/apps/eCommerce/types",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],qe=()=>e.jsxs(_e,{children:[e.jsx(k,{element:e.jsx(Ae,{}),children:e.jsx(k,{path:"types",element:e.jsxs(e.Fragment,{children:[e.jsx(Ie,{breadcrumbs:Ue,children:"Types list"}),e.jsx(He,{})]})})}),e.jsx(k,{index:!0,element:e.jsx(De,{to:"/apps/eCommerce/types"})})]});export{qe as default};
