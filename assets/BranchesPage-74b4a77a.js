import{r as t,j as e,y as U,z as u,a7 as q,t as P,H as de,U as f,K as ce,a2 as me,T as ue,C as he,k as pe,l as B,O as be,P as xe,N as ge}from"./index-3fc7229d.js";import{d as T,e as fe,f as je,g as ve,h as ye,k as L,u as we,Q as N}from"./consts-623f6364.js";import{c as V,u as K,d as W,e as ke,f as Se,h as Ne,i as Ce,Q as Ie,b as Ae}from"./QueryResponseProvider-77dea486.js";import{u as M,K as Be}from"./KTCard-b9bf9ea0.js";import{M as j,D as Me,H as Te}from"./index-e6154615.js";import{u as D,B as v,c as S,T as E,I as R,d as _e,b as He,M as $}from"./Delete-084d83f5.js";import"./utils-19cf3ef4.js";import"./hasClass-fa5ac91c.js";const O=t.createContext(T),Fe=({children:o})=>{const[r,h]=t.useState(T.selected),[p,n]=t.useState(T.itemIdForUpdate),{isLoading:m}=V(),i=K(),b=t.useMemo(()=>fe(m,i),[m,i]),s=t.useMemo(()=>je(i,r),[i,r]);return e.jsx(O.Provider,{value:{selected:r,itemIdForUpdate:p,setItemIdForUpdate:n,disabled:b,isAllSelected:s,onSelect:d=>{ve(d,r,h)},onSelectAll:()=>{ye(s,h,i)},clearSelected:()=>{h([])}},children:o})},x=()=>t.useContext(O),Pe=()=>{const o={borderRadius:"0.475rem",boxShadow:"0 0 50px 0 rgb(82 63 105 / 15%)",backgroundColor:"#fff",color:"#7e8299",fontWeight:"500",margin:"0",width:"auto",padding:"1rem 2rem",top:"calc(50% - 2rem)",left:"calc(50% - 4rem)"};return e.jsx("div",{style:{...o,position:"absolute",textAlign:"center"},children:"Processing..."})},De=U().shape({name:u().min(3,"Minimum 3 symbols").required("Name is required"),workingHours:u().min(3,"Minimum 3 symbols").optional(),address:u().min(3,"Minimum 3 symbols").optional(),imgCover:u().min(3,"Minimum 3 symbols").optional(),phone:q().of(u()).min(1,"Minimum 3 symbols").optional(),gmap:u().min(3,"Minimum 3 symbols").optional()}),Q=({branch:o,isBranchLoading:r})=>{const{setItemIdForUpdate:h}=x(),{refetch:p}=V(),[n]=t.useState({...o}),m=d=>{d&&p(),h(void 0)},i=P("media/svg/avatars/blank.svg"),b=P(`media/${n.imgCover}`),s=de({initialValues:n,validationSchema:De,onSubmit:async(d,{setSubmitting:y})=>{y(!0);try{L(d._id)?await W(d==null?void 0:d._id,d):await ke(d)}catch(g){console.error(g)}finally{y(!0),m(!0)}}});return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"kt_modal_add_user_form",className:"form ",onSubmit:s.handleSubmit,noValidate:!0,children:e.jsxs("div",{className:"d-flex flex-column scroll-y me-n7 pe-7",id:"kt_modal_add_user_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_user_header","data-kt-scroll-wrappers":"#kt_modal_add_user_scroll","data-kt-scroll-offset":"300px",children:[e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"d-block fw-bold fs-6 ms-2 mb-5",children:"ImgCover"}),e.jsx("div",{className:"image-input image-input-outline ms-2","data-kt-image-input":"true",style:{backgroundImage:`url('${i}')`},children:e.jsx("div",{className:"image-input-wrapper w-125px h-125px ms-2",style:{backgroundImage:`url('${b}')`}})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 ps-2 mb-2",children:"Name"}),e.jsx("input",{placeholder:"Branch name",...s.getFieldProps("name"),type:"text",name:"name",className:f("form-control form-control-solid mb-3 ms-2 mb-lg-0",{"is-invalid":s.touched.name&&s.errors.name},{"is-valid":s.touched.name&&!s.errors.name}),autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.name&&s.errors.name&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("div",{className:"fv-help-block",children:e.jsx("span",{role:"alert",children:s.errors.name})})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6  ms-2 mb-2",children:"Working hours"}),e.jsx("input",{placeholder:"Working hours",...s.getFieldProps("workingHours"),className:f("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.workingHours&&s.errors.workingHours},{"is-valid":s.touched.workingHours&&!s.errors.workingHours}),type:"text",name:"workingHours",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.workingHours&&s.errors.workingHours&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.workingHours})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 mb-2 ms-2",children:"Address"}),e.jsx("input",{placeholder:"Address",...s.getFieldProps("address"),className:f("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.address&&s.errors.address},{"is-valid":s.touched.address&&!s.errors.address}),type:"text",name:"address",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.address&&s.errors.address&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.address})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 mb-2 ms-2",children:"Phone"}),e.jsx("input",{placeholder:"Phone",...s.getFieldProps("phone"),className:f("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.phone&&s.errors.phone},{"is-valid":s.touched.phone&&!s.errors.phone}),type:"text",name:"phone",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.phone&&s.errors.phone&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.phone})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 mb-2 ms-2",children:"Google map link"}),e.jsx("input",{placeholder:"Google map link",...s.getFieldProps("gmap"),className:f("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.gmap&&s.errors.gmap},{"is-valid":s.touched.gmap&&!s.errors.gmap}),type:"text",name:"gmap",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.gmap&&s.errors.gmap&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.gmap})})]}),e.jsxs("div",{className:"text-center pt-15",children:[e.jsx("button",{type:"reset",onClick:()=>m(),className:"btn btn-light me-3","data-kt-users-modal-action":"cancel",disabled:s.isSubmitting||r,children:"Discard"}),e.jsxs("button",{type:"submit",className:"btn btn-primary","data-kt-users-modal-action":"submit",disabled:r||s.isSubmitting||!s.isValid||!s.touched,children:[e.jsx("span",{className:"indicator-label",children:"Submit"}),(s.isSubmitting||r)&&e.jsxs("span",{className:"indicator-progress",children:["Please wait..."," ",e.jsx("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})}),(s.isSubmitting||r)&&e.jsx(Pe,{})]})},Ee=()=>{const{itemIdForUpdate:o,setItemIdForUpdate:r}=x(),h=L(o),{isLoading:p,data:n,error:m}=we(`${N.BRNACHES_LIST}-branch-${o}`,()=>Se(o),{cacheTime:0,enabled:h,onError:i=>{r(void 0),console.error(i)}});return o?!p&&!m&&n?e.jsx(Q,{isBranchLoading:p,branch:n}):null:e.jsx(Q,{isBranchLoading:p,branch:{name:" "}})},Re=()=>{const{setItemIdForUpdate:o}=x();return e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"fw-bolder",children:"Add Branch"}),e.jsx("div",{className:"btn btn-icon btn-sm btn-active-icon-primary","data-kt-users-modal-action":"close",onClick:()=>o(void 0),style:{cursor:"pointer"},children:e.jsx(ce,{iconName:"cross",className:"fs-1"})})]})},$e=()=>(t.useEffect(()=>(document.body.classList.add("modal-open"),()=>{document.body.classList.remove("modal-open")}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal fade show d-block",id:"kt_modal_add_user",role:"dialog",tabIndex:-1,"aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered mw-650px",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(Re,{}),e.jsx("div",{className:"modal-body scroll-y mx-5 mx-xl-15 my-7",children:e.jsx(Ee,{})})]})})}),e.jsx("div",{className:"modal-backdrop fade show"})]})),Qe=()=>{const{selected:o,clearSelected:r}=x(),h=me(),{setItemIdForUpdate:p}=x(),[n,m]=t.useState({}),{active:i,archived:b}=K(),[s,d]=t.useState(!1),[y,g]=t.useState(i),[G,C]=t.useState(()=>b),[l,z]=t.useState(null),[w,k]=t.useState(null),[J,I]=t.useState(!1),[X,Y]=t.useState(),Z=t.useMemo(()=>[{accessorKey:"name",header:"Name",muiEditTextFieldProps:{required:!0,error:!!(n!=null&&n.name),helperText:n==null?void 0:n.name,onFocus:()=>m({...n,name:void 0})}},{accessorKey:"workingHours",header:"Working Hours"},{accessorKey:"phone",header:"Phone"}],[]),ee=U().shape({name:u().min(3,"Minimum 3 symbols").required("Name is required"),workingHours:u().min(3,"Minimum 3 symbols").optional(),address:u().min(3,"Minimum 3 symbols").optional(),imgCover:u().min(3,"Minimum 3 symbols").optional(),phone:q().of(u()).min(1,"Minimum 3 symbols").optional(),gmap:u().min(3,"Minimum 3 symbols").optional()}),se=async a=>{console.log(a.row.original),ee.validate(a.row.original).catch(c=>m(c.message)),m({}),await A.mutateAsync({id:a.row.original._id,update:a.values}),F.setEditingRow(null)},ae=()=>{I(!0)},re=async()=>{await oe.mutateAsync(),I(!1)},te=()=>{p(null)},_=()=>{I(!1)},oe=M(()=>Ne(X),{onSuccess:()=>{h.invalidateQueries([`${N.BRNACHES_LIST}`]),d(!0)}}),ne=M(a=>Ce(a),{onSuccess:()=>{h.invalidateQueries([`${N.BRNACHES_LIST}`]),d(!0),r()}}),A=M(({id:a,update:c})=>W(a,c),{onSuccess:()=>{h.invalidateQueries([`${N.BRNACHES_LIST}`])}}),H={columns:Z,enableRowDragging:!0,enableFullScreenToggle:!1,muiTableContainerProps:{sx:{minHeight:"320px"}},onDraggingRowChange:z,state:{draggingRow:l}};t.useEffect(()=>{console.log("branche",i),g(i),C(b)},[i,b,s]);const F=D({...H,enableRowSelection:!0,enableStickyHeader:!0,enableCellActions:!0,enableClickToCopy:"context-menu",enableEditing:!0,editDisplayMode:"row",createDisplayMode:"row",rowPinningDisplayMode:"select-sticky",positionToolbarAlertBanner:"bottom",positionActionsColumn:"last",state:{columnOrder:["mrt-row-select","mrt-row-drag","name","workingHours","phone"]},renderTopToolbarCustomActions:({table:a})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-success",children:"Active"})}),e.jsxs(v,{sx:{display:"flex",gap:"1rem",p:"4px",justifyContent:"right"},children:[e.jsx(S,{color:"info",onClick:te,variant:"contained",children:"Add Branch"}),e.jsx(S,{color:"error",onClick:async()=>{let c=[];a.getSelectedRowModel().rows.map(le=>c.push(le.original._id)),console.log(c),await ne.mutateAsync(c)},variant:"contained",children:"Delete Selected"})]})]}),data:y,onEditingRowCancel:()=>m({}),onEditingRowSave:a=>se(a),getRowId:a=>`table-1-${a.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{w==="table-2"&&(await A.mutateAsync({id:l==null?void 0:l.original._id,update:{deleted:!0}}),C(a=>[...a,l.original]),g(a=>a.filter(c=>c!==l.original))),k(null)}},muiTablePaperProps:{onDragEnter:()=>k("table-1"),sx:{outline:w==="table-1"?"2px dashed green":void 0}},renderRowActions:({row:a,table:c})=>e.jsxs(v,{sx:{display:"flex",gap:"1rem"},children:[e.jsx(E,{title:"Edit",children:e.jsx(R,{onClick:()=>c.setEditingRow(a),children:e.jsx(_e,{})})}),e.jsx(E,{title:"Delete",children:e.jsx(R,{color:"error",onClick:()=>{Y(a.original._id),ae()},children:e.jsx(He,{})})})]})}),ie=D({...H,data:G,defaultColumn:{size:100},state:{columnOrder:["mrt-row-select","mrt-row-drag","name","workingHours","phone"]},getRowId:a=>`table-2-${a.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{w==="table-1"&&(console.log("getRowId",l==null?void 0:l.original._id),await A.mutateAsync({id:l==null?void 0:l.original._id,update:{deleted:!1}}),g(a=>[...a,l.original]),C(a=>a.filter(c=>c!==l.original))),k(null)}},muiTablePaperProps:{onDragEnter:()=>k("table-2"),sx:{outline:w==="table-2"?"2px dashed pink":void 0}},renderTopToolbarCustomActions:()=>e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-danger",children:"Archive"})})});return e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx($,{table:F})}),e.jsx(v,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx($,{table:ie})}),e.jsxs(j,{show:J,onHide:_,children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{children:"Confirm Deletion"})}),e.jsx(j.Body,{children:"Are you sure you want to delete this item?"}),e.jsx(j.Footer,{children:e.jsxs(v,{sx:{display:"flex",gap:"1rem",p:"4px"},children:[e.jsx(S,{color:"info",variant:"contained",onClick:_,children:"Cancel"}),e.jsx(S,{color:"error",variant:"contained",onClick:re,children:"Delete"})]})})]})]})},Ue=()=>{const{itemIdForUpdate:o}=x();return e.jsxs(e.Fragment,{children:[e.jsx(Be,{children:e.jsx(Qe,{})}),o!==void 0&&e.jsx($e,{})]})},qe=()=>e.jsx(Ie,{children:e.jsx(Ae,{children:e.jsxs(Fe,{children:[e.jsx(ue,{}),e.jsx(he,{children:e.jsx(Me,{backend:Te,children:e.jsx(Ue,{})})})]})})}),Le=[{title:"Branch Management",path:"/apps/eCommerce/branches",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],Ye=()=>e.jsxs(pe,{children:[e.jsx(B,{element:e.jsx(be,{}),children:e.jsx(B,{path:"branches",element:e.jsxs(e.Fragment,{children:[e.jsx(xe,{breadcrumbs:Le,children:"Branch list"}),e.jsx(qe,{})]})})}),e.jsx(B,{index:!0,element:e.jsx(ge,{to:"/apps/eCommerce/branches"})})]});export{Ye as default};
