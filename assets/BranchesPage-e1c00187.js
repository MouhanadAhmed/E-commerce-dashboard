import{r as t,ar as T,aD as U,aE as q,as as de,at as ce,z as e,au as me,av as ue,a0 as L,a1 as u,aF as V,G as P,a5 as he,aB as W,aG as K,aH as pe,ab as j,ao as be,aI as xe,ap as N,K as ge,ax as je,ay as B,aJ as E,aK as f,aL as D,aM as v,aN as k,aO as fe,aP as ve,aQ as R,aR as $,aS as ye,aT as we,aU as Se,aV as ke,T as Ne,E as Ce,aW as Ie,aX as Ae,aC as Be,M as Me,N as M,O as Te,P as _e,Q as Fe}from"./index-9864f4cb.js";const O=t.createContext(T),He=({children:o})=>{const[r,h]=t.useState(T.selected),[p,n]=t.useState(T.itemIdForUpdate),{isLoading:m}=U(),l=q(),b=t.useMemo(()=>de(m,l),[m,l]),s=t.useMemo(()=>ce(l,r),[l,r]);return e.jsx(O.Provider,{value:{selected:r,itemIdForUpdate:p,setItemIdForUpdate:n,disabled:b,isAllSelected:s,onSelect:d=>{me(d,r,h)},onSelectAll:()=>{ue(s,h,l)},clearSelected:()=>{h([])}},children:o})},x=()=>t.useContext(O),Pe=()=>{const o={borderRadius:"0.475rem",boxShadow:"0 0 50px 0 rgb(82 63 105 / 15%)",backgroundColor:"#fff",color:"#7e8299",fontWeight:"500",margin:"0",width:"auto",padding:"1rem 2rem",top:"calc(50% - 2rem)",left:"calc(50% - 4rem)"};return e.jsx("div",{style:{...o,position:"absolute",textAlign:"center"},children:"Processing..."})},Ee=L().shape({name:u().min(3,"Minimum 3 symbols").required("Name is required"),workingHours:u().min(3,"Minimum 3 symbols").optional(),address:u().min(3,"Minimum 3 symbols").optional(),imgCover:u().min(3,"Minimum 3 symbols").optional(),phone:V().of(u()).min(1,"Minimum 3 symbols").optional(),gmap:u().min(3,"Minimum 3 symbols").optional()}),Q=({branch:o,isBranchLoading:r})=>{const{setItemIdForUpdate:h}=x(),{refetch:p}=U(),[n]=t.useState({...o}),m=d=>{d&&p(),h(void 0)},l=P("media/svg/avatars/blank.svg"),b=P(`media/${n.imgCover}`),s=he({initialValues:n,validationSchema:Ee,onSubmit:async(d,{setSubmitting:y})=>{y(!0);try{W(d._id)?await K(d==null?void 0:d._id,d):await pe(d)}catch(g){console.error(g)}finally{y(!0),m(!0)}}});return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"kt_modal_add_user_form",className:"form ",onSubmit:s.handleSubmit,noValidate:!0,children:e.jsxs("div",{className:"d-flex flex-column scroll-y me-n7 pe-7",id:"kt_modal_add_user_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_user_header","data-kt-scroll-wrappers":"#kt_modal_add_user_scroll","data-kt-scroll-offset":"300px",children:[e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"d-block fw-bold fs-6 ms-2 mb-5",children:"ImgCover"}),e.jsx("div",{className:"image-input image-input-outline ms-2","data-kt-image-input":"true",style:{backgroundImage:`url('${l}')`},children:e.jsx("div",{className:"image-input-wrapper w-125px h-125px ms-2",style:{backgroundImage:`url('${b}')`}})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 ps-2 mb-2",children:"Name"}),e.jsx("input",{placeholder:"Branch name",...s.getFieldProps("name"),type:"text",name:"name",className:j("form-control form-control-solid mb-3 ms-2 mb-lg-0",{"is-invalid":s.touched.name&&s.errors.name},{"is-valid":s.touched.name&&!s.errors.name}),autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.name&&s.errors.name&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("div",{className:"fv-help-block",children:e.jsx("span",{role:"alert",children:s.errors.name})})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6  ms-2 mb-2",children:"Working hours"}),e.jsx("input",{placeholder:"Working hours",...s.getFieldProps("workingHours"),className:j("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.workingHours&&s.errors.workingHours},{"is-valid":s.touched.workingHours&&!s.errors.workingHours}),type:"text",name:"workingHours",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.workingHours&&s.errors.workingHours&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.workingHours})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 mb-2 ms-2",children:"Address"}),e.jsx("input",{placeholder:"Address",...s.getFieldProps("address"),className:j("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.address&&s.errors.address},{"is-valid":s.touched.address&&!s.errors.address}),type:"text",name:"address",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.address&&s.errors.address&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.address})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 mb-2 ms-2",children:"Phone"}),e.jsx("input",{placeholder:"Phone",...s.getFieldProps("phone"),className:j("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.phone&&s.errors.phone},{"is-valid":s.touched.phone&&!s.errors.phone}),type:"text",name:"phone",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.phone&&s.errors.phone&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.phone})})]}),e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 mb-2 ms-2",children:"Google map link"}),e.jsx("input",{placeholder:"Google map link",...s.getFieldProps("gmap"),className:j("form-control form-control-solid mb-3 mb-lg-0 ms-2",{"is-invalid":s.touched.gmap&&s.errors.gmap},{"is-valid":s.touched.gmap&&!s.errors.gmap}),type:"text",name:"gmap",autoComplete:"off",disabled:s.isSubmitting||r}),s.touched.gmap&&s.errors.gmap&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("span",{role:"alert",children:s.errors.gmap})})]}),e.jsxs("div",{className:"text-center pt-15",children:[e.jsx("button",{type:"reset",onClick:()=>m(),className:"btn btn-light me-3","data-kt-users-modal-action":"cancel",disabled:s.isSubmitting||r,children:"Discard"}),e.jsxs("button",{type:"submit",className:"btn btn-primary","data-kt-users-modal-action":"submit",disabled:r||s.isSubmitting||!s.isValid||!s.touched,children:[e.jsx("span",{className:"indicator-label",children:"Submit"}),(s.isSubmitting||r)&&e.jsxs("span",{className:"indicator-progress",children:["Please wait..."," ",e.jsx("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})}),(s.isSubmitting||r)&&e.jsx(Pe,{})]})},De=()=>{const{itemIdForUpdate:o,setItemIdForUpdate:r}=x(),h=W(o),{isLoading:p,data:n,error:m}=be(`${N.BRNACHES_LIST}-branch-${o}`,()=>xe(o),{cacheTime:0,enabled:h,onError:l=>{r(void 0),console.error(l)}});return o?!p&&!m&&n?e.jsx(Q,{isBranchLoading:p,branch:n}):null:e.jsx(Q,{isBranchLoading:p,branch:{name:" "}})},Re=()=>{const{setItemIdForUpdate:o}=x();return e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"fw-bolder",children:"Add Branch"}),e.jsx("div",{className:"btn btn-icon btn-sm btn-active-icon-primary","data-kt-users-modal-action":"close",onClick:()=>o(void 0),style:{cursor:"pointer"},children:e.jsx(ge,{iconName:"cross",className:"fs-1"})})]})},$e=()=>(t.useEffect(()=>(document.body.classList.add("modal-open"),()=>{document.body.classList.remove("modal-open")}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal fade show d-block",id:"kt_modal_add_user",role:"dialog",tabIndex:-1,"aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered mw-650px",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(Re,{}),e.jsx("div",{className:"modal-body scroll-y mx-5 mx-xl-15 my-7",children:e.jsx(De,{})})]})})}),e.jsx("div",{className:"modal-backdrop fade show"})]})),Qe=()=>{const{selected:o,clearSelected:r}=x(),h=je(),{setItemIdForUpdate:p}=x(),[n,m]=t.useState({}),{active:l,archived:b}=q(),[s,d]=t.useState(!1),[y,g]=t.useState(l),[G,C]=t.useState(()=>b),[i,z]=t.useState(null),[w,S]=t.useState(null),[J,I]=t.useState(!1),[X,Y]=t.useState(),Z=t.useMemo(()=>[{accessorKey:"name",header:"Name",muiEditTextFieldProps:{required:!0,error:!!(n!=null&&n.name),helperText:n==null?void 0:n.name,onFocus:()=>m({...n,name:void 0})}},{accessorKey:"workingHours",header:"Working Hours"},{accessorKey:"phone",header:"Phone"}],[]),ee=L().shape({name:u().min(3,"Minimum 3 symbols").required("Name is required"),workingHours:u().min(3,"Minimum 3 symbols").optional(),address:u().min(3,"Minimum 3 symbols").optional(),imgCover:u().min(3,"Minimum 3 symbols").optional(),phone:V().of(u()).min(1,"Minimum 3 symbols").optional(),gmap:u().min(3,"Minimum 3 symbols").optional()}),se=async a=>{console.log(a.row.original),ee.validate(a.row.original).catch(c=>m(c.message)),m({}),await A.mutateAsync({id:a.row.original._id,update:a.values}),H.setEditingRow(null)},ae=()=>{I(!0)},re=async()=>{await oe.mutateAsync(),I(!1)},te=()=>{p(null)},_=()=>{I(!1)},oe=B(()=>fe(X),{onSuccess:()=>{h.invalidateQueries([`${N.BRNACHES_LIST}`]),d(!0)}}),ne=B(a=>ve(a),{onSuccess:()=>{h.invalidateQueries([`${N.BRNACHES_LIST}`]),d(!0),r()}}),A=B(({id:a,update:c})=>K(a,c),{onSuccess:()=>{h.invalidateQueries([`${N.BRNACHES_LIST}`])}}),F={columns:Z,enableRowDragging:!0,enableFullScreenToggle:!1,muiTableContainerProps:{sx:{minHeight:"320px"}},onDraggingRowChange:z,state:{draggingRow:i}};t.useEffect(()=>{console.log("branche",l),g(l),C(b)},[l,b,s]);const H=E({...F,enableRowSelection:!0,enableStickyHeader:!0,enableCellActions:!0,enableClickToCopy:"context-menu",enableEditing:!0,editDisplayMode:"row",createDisplayMode:"row",rowPinningDisplayMode:"select-sticky",positionToolbarAlertBanner:"bottom",positionActionsColumn:"last",state:{columnOrder:["mrt-row-select","mrt-row-drag","name","workingHours","phone"]},renderTopToolbarCustomActions:({table:a})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-success",children:"Active"})}),e.jsxs(f,{sx:{display:"flex",gap:"1rem",p:"4px",justifyContent:"right"},children:[e.jsx(k,{color:"info",onClick:te,variant:"contained",children:"Add Branch"}),e.jsx(k,{color:"error",onClick:async()=>{let c=[];a.getSelectedRowModel().rows.map(ie=>c.push(ie.original._id)),console.log(c),await ne.mutateAsync(c)},variant:"contained",children:"Delete Selected"})]})]}),data:y,onEditingRowCancel:()=>m({}),onEditingRowSave:a=>se(a),getRowId:a=>`table-1-${a.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{w==="table-2"&&(await A.mutateAsync({id:i==null?void 0:i.original._id,update:{deleted:!0}}),C(a=>[...a,i.original]),g(a=>a.filter(c=>c!==i.original))),S(null)}},muiTablePaperProps:{onDragEnter:()=>S("table-1"),sx:{outline:w==="table-1"?"2px dashed green":void 0}},renderRowActions:({row:a,table:c})=>e.jsxs(f,{sx:{display:"flex",gap:"1rem"},children:[e.jsx(R,{title:"Edit",children:e.jsx($,{onClick:()=>c.setEditingRow(a),children:e.jsx(ye,{})})}),e.jsx(R,{title:"Delete",children:e.jsx($,{color:"error",onClick:()=>{Y(a.original._id),ae()},children:e.jsx(we,{})})})]})}),le=E({...F,data:G,defaultColumn:{size:100},state:{columnOrder:["mrt-row-select","mrt-row-drag","name","workingHours","phone"]},getRowId:a=>`table-2-${a.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{w==="table-1"&&(console.log("getRowId",i==null?void 0:i.original._id),await A.mutateAsync({id:i==null?void 0:i.original._id,update:{deleted:!1}}),g(a=>[...a,i.original]),C(a=>a.filter(c=>c!==i.original))),S(null)}},muiTablePaperProps:{onDragEnter:()=>S("table-2"),sx:{outline:w==="table-2"?"2px dashed pink":void 0}},renderTopToolbarCustomActions:()=>e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-danger",children:"Archive"})})});return e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx(D,{table:H})}),e.jsx(f,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx(D,{table:le})}),e.jsxs(v,{show:J,onHide:_,children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Confirm Deletion"})}),e.jsx(v.Body,{children:"Are you sure you want to delete this item?"}),e.jsx(v.Footer,{children:e.jsxs(f,{sx:{display:"flex",gap:"1rem",p:"4px"},children:[e.jsx(k,{color:"info",variant:"contained",onClick:_,children:"Cancel"}),e.jsx(k,{color:"error",variant:"contained",onClick:re,children:"Delete"})]})})]})]})},Ue=()=>{const{itemIdForUpdate:o}=x();return e.jsxs(e.Fragment,{children:[e.jsx(Be,{children:e.jsx(Qe,{})}),o!==void 0&&e.jsx($e,{})]})},qe=()=>e.jsx(Se,{children:e.jsx(ke,{children:e.jsxs(He,{children:[e.jsx(Ne,{}),e.jsx(Ce,{children:e.jsx(Ie,{backend:Ae,children:e.jsx(Ue,{})})})]})})}),Le=[{title:"Branch Management",path:"/apps/eCommerce/branches",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],We=()=>e.jsxs(Me,{children:[e.jsx(M,{element:e.jsx(Te,{}),children:e.jsx(M,{path:"branches",element:e.jsxs(e.Fragment,{children:[e.jsx(_e,{breadcrumbs:Le,children:"Branch list"}),e.jsx(qe,{})]})})}),e.jsx(M,{index:!0,element:e.jsx(Fe,{to:"/apps/eCommerce/branches"})})]});export{We as default};
