import{r as a,j as e,y as R,z as L,H as ne,U as le,K as ie,a2 as de,T as ce,C as me,k as ue,l as k,O as pe,P as xe,N as he}from"./index-b5515533.js";import{d as _,e as be,f as ge,g as je,h as ye,k as H,u as fe,Q as v}from"./consts-d215bccc.js";import{c as Q,u as U,d as $,e as ve,f as Se,h as Te,i as we,Q as Ce,b as ke}from"./QueryResponseProvider-e964f6d4.js";import{u as N,K as Ne}from"./KTCard-4cc4d024.js";import{u as E,B as b,c as f,T as F,I as M,d as _e,b as Ie,M as P}from"./Delete-9a9970bf.js";import{M as g,D as Ae,H as De}from"./index-1c80dd71.js";import"./hasClass-14f1d72f.js";import"./utils-30b83324.js";const q=a.createContext(_),Ee=({children:o})=>{const[n,m]=a.useState(_.selected),[u,l]=a.useState(_.itemIdForUpdate),{isLoading:c}=Q(),s=U(),r=a.useMemo(()=>be(c,s),[c,s]),p=a.useMemo(()=>ge(s,n),[s,n]);return e.jsx(q.Provider,{value:{selected:n,itemIdForUpdate:u,setItemIdForUpdate:l,disabled:r,isAllSelected:p,onSelect:x=>{je(x,n,m)},onSelectAll:()=>{ye(p,m,s)},clearSelected:()=>{m([])}},children:o})},h=()=>a.useContext(q),Fe=()=>{const o={borderRadius:"0.475rem",boxShadow:"0 0 50px 0 rgb(82 63 105 / 15%)",backgroundColor:"#fff",color:"#7e8299",fontWeight:"500",margin:"0",width:"auto",padding:"1rem 2rem",top:"calc(50% - 2rem)",left:"calc(50% - 4rem)"};return e.jsx("div",{style:{...o,position:"absolute",textAlign:"center"},children:"Processing..."})},Me=R().shape({name:L().min(3,"Minimum 3 symbols").required("Name is required")}),B=({category:o,isCategoryLoading:n})=>{const{setItemIdForUpdate:m}=h(),{refetch:u}=Q(),[l]=a.useState({...o}),c=r=>{r&&u(),m(void 0)},s=ne({initialValues:l,validationSchema:Me,onSubmit:async(r,{setSubmitting:p})=>{p(!0);try{H(r._id)?await $(r==null?void 0:r._id,r):(console.log("values",r),delete r.available,await ve(r))}catch(x){console.error(x)}finally{p(!0),c(!0)}}});return e.jsxs(e.Fragment,{children:[e.jsxs("form",{id:"kt_modal_add_user_form",className:"form ",onSubmit:s.handleSubmit,noValidate:!0,children:[e.jsx("div",{className:"d-flex flex-column scroll-y me-n7 pe-7",id:"kt_modal_add_user_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_user_header","data-kt-scroll-wrappers":"#kt_modal_add_user_scroll","data-kt-scroll-offset":"300px",children:e.jsxs("div",{className:"fv-row mb-7",children:[e.jsx("label",{className:"required fw-bold fs-6 ps-2 mb-2",children:"Name"}),e.jsx("input",{placeholder:"Full name",...s.getFieldProps("name"),type:"text",name:"name",className:le("form-control form-control-solid mb-3 ms-2 mb-lg-0",{"is-invalid":s.touched.name&&s.errors.name},{"is-valid":s.touched.name&&!s.errors.name}),autoComplete:"off",disabled:s.isSubmitting||n}),s.touched.name&&s.errors.name&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("div",{className:"fv-help-block",children:e.jsx("span",{role:"alert",children:s.errors.name})})})]})}),e.jsxs("div",{className:"text-center pt-15",children:[e.jsx("button",{type:"reset",onClick:()=>c(),className:"btn btn-light me-3","data-kt-users-modal-action":"cancel",disabled:s.isSubmitting||n,children:"Discard"}),e.jsxs("button",{type:"submit",className:"btn btn-primary","data-kt-users-modal-action":"submit",disabled:n||s.isSubmitting||!s.isValid||!s.touched,children:[e.jsx("span",{className:"indicator-label",children:"Submit"}),(s.isSubmitting||n)&&e.jsxs("span",{className:"indicator-progress",children:["Please wait..."," ",e.jsx("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]}),(s.isSubmitting||n)&&e.jsx(Fe,{})]})},Pe=()=>{const{itemIdForUpdate:o,setItemIdForUpdate:n}=h(),m=H(o),{isLoading:u,data:l,error:c}=fe(`${v.TYPES_LIST}-type-${o}`,()=>Se(o),{cacheTime:0,enabled:m,onError:s=>{n(void 0),console.error(s)}});return o?!u&&!c&&l?e.jsx(B,{isCategoryLoading:u,category:l}):null:e.jsx(B,{isCategoryLoading:u,category:{_id:void 0,available:!0}})},Be=()=>{const{setItemIdForUpdate:o}=h();return e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"fw-bolder",children:"Add Type"}),e.jsx("div",{className:"btn btn-icon btn-sm btn-active-icon-primary","data-kt-users-modal-action":"close",onClick:()=>o(void 0),style:{cursor:"pointer"},children:e.jsx(ie,{iconName:"cross",className:"fs-1"})})]})},Re=()=>(a.useEffect(()=>(document.body.classList.add("modal-open"),()=>{document.body.classList.remove("modal-open")}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal fade show d-block",id:"kt_modal_add_user",role:"dialog",tabIndex:-1,"aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered mw-650px",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(Be,{}),e.jsx("div",{className:"modal-body scroll-y mx-5 mx-xl-15 my-7",children:e.jsx(Pe,{})})]})})}),e.jsx("div",{className:"modal-backdrop fade show"})]})),Le=()=>{const{selected:o,clearSelected:n}=h(),m=de(),{setItemIdForUpdate:u}=h(),[l,c]=a.useState({}),{active:s,archived:r}=U(),[p,x]=a.useState(!1),[V,S]=a.useState(s),[O,T]=a.useState(()=>r),[i,K]=a.useState(null),[j,y]=a.useState(null),[W,w]=a.useState(!1),[z,G]=a.useState(),Y=a.useMemo(()=>[{accessorKey:"name",header:"Name",muiEditTextFieldProps:{required:!0,error:!!(l!=null&&l.name),helperText:l==null?void 0:l.name,onFocus:()=>c({...l,name:void 0})}}],[]),J=R().shape({name:L().min(3,"Minimum 3 symbols").required("Name is required")}),X=async t=>{console.log(t.row.original),J.validate(t.row.original).catch(d=>c(d.message)),c({}),await C.mutateAsync({id:t.row.original._id,update:t.values}),D.setEditingRow(null)},Z=()=>{w(!0)},ee=async()=>{await te.mutateAsync(),w(!1)},se=()=>{u(null)},I=()=>{w(!1)},te=N(()=>Te(z),{onSuccess:()=>{m.invalidateQueries([`${v.BRNACHES_LIST}`]),x(!0)}}),ae=N(t=>we(t),{onSuccess:()=>{m.invalidateQueries([`${v.BRNACHES_LIST}`]),x(!0),n()}}),C=N(({id:t,update:d})=>$(t,d),{onSuccess:()=>{m.invalidateQueries([`${v.BRNACHES_LIST}`])}}),A={columns:Y,enableRowDragging:!0,enableFullScreenToggle:!1,muiTableContainerProps:{sx:{minHeight:"320px"}},onDraggingRowChange:K,state:{draggingRow:i}};a.useEffect(()=>{console.log("branche",s),S(s),T(r)},[s,r,p]);const D=E({...A,enableRowSelection:!0,enableStickyHeader:!0,enableCellActions:!0,enableClickToCopy:"context-menu",enableEditing:!0,editDisplayMode:"row",createDisplayMode:"row",rowPinningDisplayMode:"select-sticky",positionToolbarAlertBanner:"bottom",positionActionsColumn:"last",state:{columnOrder:["mrt-row-select","mrt-row-drag","name"]},renderTopToolbarCustomActions:({table:t})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-success",children:"Active"})}),e.jsxs(b,{sx:{display:"flex",gap:"1rem",p:"4px",justifyContent:"right"},children:[e.jsx(f,{color:"info",onClick:se,variant:"contained",children:"Add Type"}),e.jsx(f,{color:"error",onClick:async()=>{let d=[];t.getSelectedRowModel().rows.map(oe=>d.push(oe.original._id)),console.log(d),await ae.mutateAsync(d)},variant:"contained",children:"Delete Selected"})]})]}),data:V,onEditingRowCancel:()=>c({}),onEditingRowSave:t=>X(t),getRowId:t=>`table-1-${t.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{j==="table-2"&&(await C.mutateAsync({id:i==null?void 0:i.original._id,update:{deleted:!0}}),T(t=>[...t,i.original]),S(t=>t.filter(d=>d!==i.original))),y(null)}},muiTablePaperProps:{onDragEnter:()=>y("table-1"),sx:{outline:j==="table-1"?"2px dashed green":void 0}},renderRowActions:({row:t,table:d})=>e.jsxs(b,{sx:{display:"flex",gap:"1rem"},children:[e.jsx(F,{title:"Edit",children:e.jsx(M,{onClick:()=>d.setEditingRow(t),children:e.jsx(_e,{})})}),e.jsx(F,{title:"Delete",children:e.jsx(M,{color:"error",onClick:()=>{G(t.original._id),Z()},children:e.jsx(Ie,{})})})]})}),re=E({...A,data:O,defaultColumn:{size:100},state:{columnOrder:["mrt-row-select","mrt-row-drag","name"]},getRowId:t=>`table-2-${t.name}`,muiRowDragHandleProps:{onDragEnd:async()=>{j==="table-1"&&(console.log("getRowId",i==null?void 0:i.original._id),await C.mutateAsync({id:i==null?void 0:i.original._id,update:{deleted:!1}}),S(t=>[...t,i.original]),T(t=>t.filter(d=>d!==i.original))),y(null)}},muiTablePaperProps:{onDragEnter:()=>y("table-2"),sx:{outline:j==="table-2"?"2px dashed pink":void 0}},renderTopToolbarCustomActions:()=>e.jsx("div",{className:"card-header ribbon ribbon-start",children:e.jsx("div",{className:"ribbon-label ribbon ribbon-start bg-danger",children:"Archive"})})});return e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx(P,{table:D})}),e.jsx(b,{sx:{display:"grid",gap:"1rem",overflow:"auto",p:"4px"},children:e.jsx(P,{table:re})}),e.jsxs(g,{show:W,onHide:I,children:[e.jsx(g.Header,{closeButton:!0,children:e.jsx(g.Title,{children:"Confirm Deletion"})}),e.jsx(g.Body,{children:"Are you sure you want to delete this item?"}),e.jsx(g.Footer,{children:e.jsxs(b,{sx:{display:"flex",gap:"1rem",p:"4px"},children:[e.jsx(f,{color:"info",variant:"contained",onClick:I,children:"Cancel"}),e.jsx(f,{color:"error",variant:"contained",onClick:ee,children:"Delete"})]})})]})]})},He=()=>{const{itemIdForUpdate:o}=h();return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsx(Le,{})}),o!==void 0&&e.jsx(Re,{})]})},Qe=()=>e.jsx(Ce,{children:e.jsx(ke,{children:e.jsxs(Ee,{children:[e.jsx(ce,{}),e.jsx(me,{children:e.jsx(Ae,{backend:De,children:e.jsx(He,{})})})]})})}),Ue=[{title:"Types Management",path:"/apps/eCommerce/types",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],Ye=()=>e.jsxs(ue,{children:[e.jsx(k,{element:e.jsx(pe,{}),children:e.jsx(k,{path:"types",element:e.jsxs(e.Fragment,{children:[e.jsx(xe,{breadcrumbs:Ue,children:"Types list"}),e.jsx(Qe,{})]})})}),e.jsx(k,{index:!0,element:e.jsx(he,{to:"/apps/eCommerce/types"})})]});export{Ye as default};
